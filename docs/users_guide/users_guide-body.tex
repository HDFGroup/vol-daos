%\section{Introduction}
%TBD
%\newpage

\section{Using the DAOS VOL connector with an HDF5 application}

This section outlines the unique aspects of writing, building and running HDF5 applications with the DAOS VOL connector.

\subsection{Writing HDF5 DAOS VOL connector applications}

\subsubsection{With the DAOS VOL connector as a dynamically-loaded plugin}

If the DAOS VOL connector is dynamically loaded by HDF5, no modifications will need to be made to an existing HDF5 application. For more information on using the DAOS VOL connector as a dynamically-loaded plugin, refer to \hyperref[hdf5:dynamically_loaded_connectors]{HDF5 and dynamically-loaded VOL connectors}.

\subsubsection{Without the DAOS VOL connector as a dynamically-loaded plugin}

If dynamic loading of the DAOS VOL connector is not used, any HDF5 application using the connector must:

\begin{enumerate}
    \item Include \texttt{daos\_vol\_public.h}, found in the \texttt{include} directory of the DAOS VOL connector installation directory.
    \item Link against \texttt{libhdf5\_vol\_daos.so} (or similar), found in the \texttt{lib} directory of the DAOS VOL connector installation directory.
\end{enumerate}

An HDF5 DAOS VOL connector application also requires three new function calls in addition to those for an equivalent HDF5 application (see Appendix~\ref{apdx:ref_manual} for more details):

\begin{itemize}
    \item \texttt{\hyperref[ref:h5daos_init]{H5daos\_init()}} - Initializes the DAOS VOL connector

    Called upon application startup, before any file is accessed.
    
    \item \texttt{\hyperref[ref:h5pset_fapl_daos]{H5Pset\_fapl\_daos()}} - Set DAOS VOL connector access on File Access Property List.

    Called to prepare a FAPL to open a file through the DAOS VOL connector. See \href{https://support.hdfgroup.org/HDF5/Tutor/property.html#fa}{HDF5 File Access Property Lists} for more information about File Access Property Lists.

    \item \texttt{\hyperref[ref:h5daos_term]{H5daos\_term()}} - Cleanly shutdown the DAOS VOL connector

    Called on application shutdown, after all files have been closed.
\end{itemize}

\newpage

\subsubsection{Skeleton Example}

Below is a no-op application that opens and closes a file using the DAOS VOL connector. For clarity, no error-checking is performed. Note that this example is meant only for the case when the DAOS VOL connector is not being dynamically loaded.

\begin{verbatim}
#include "hdf5.h"
#include "daos_vol_public.h"

int main(void)
{
    hid_t fapl_id;
    hid_t file_id;

    H5daos_init(MPI_COMM_WORLD, pool_uuid, NULL);

    fapl_id = H5Pcreate(H5P_FILE_ACCESS);
    H5Pset_fapl_daos(fapl_id, MPI_COMM_WORLD, MPI_INFO_NULL);
    file_id = H5Fopen("my/file.h5");

    /* operate on file */

    H5Pclose(fapl_id);
    H5Fclose(file_id);

    H5daos_term();

    return 0;
}
\end{verbatim}

\newpage

\subsection{Building HDF5 DAOS VOL connector applications}

Assuming an HDF5 application has been written following the instructions in the previous section, the application must be built prior to running. In general, the application should be built as normal for any other HDF5 application. However, if the DAOS VOL connector is not being dynamically loaded, the steps in the following section are required to build the application.

\subsubsection{Without the DAOS VOL connector as a dynamically-loaded plugin}

To link in the required libraries, the compiler will likely require the additional linker flags:

\begin{verbatim}
-lhdf5_vol_daos -luuid
\end{verbatim}

However, these flags may vary depending on platform, compiler and installation location of the DAOS VOL connector. It is highly recommended that compilation of HDF5 DAOS VOL connector applications be done using the \texttt{h5cc/h5pcc} script, as it will manage linking with the HDF5 library. If HDF5 was built using Autotools, this script will be called \texttt{h5pcc} and may be found in the \texttt{bin} directory of the HDF5 installation. If HDF5 was built with CMake, this script will simply be called \texttt{h5cc} and can be found in the same location. The above notice about additional library linking applies to usage of \texttt{h5cc/h5pcc}. For example:

\begin{verbatim}
h5cc/h5pcc -lhdf5_vol_daos -luuid my_daosvol_application.c -o my_executable
\end{verbatim}

\newpage

\subsection{Running HDF5 DAOS VOL connector applications}
\label{running_daos_vol_apps}

Running applications that use the HDF5 DAOS VOL connector requires access to a server which implements the \href{https://github.com/daos-stack/daos/blob/master/src/include/daos_api.h}{DAOS API}. Refer to \href{https://github.com/daos-stack/daos/blob/master/doc/quickstart.md}{DAOS Quick Start Guide} for more information on the setup process for this. For the DAOS VOL connector to correctly interact with a DAOS API-aware server instance, it must also be passed the UUID of the DAOS Pool to use and a list of DAOS Pool service replica ranks, as detailed in the following sections.

%\subsubsection{Starting the DAOS Server}
%\label{sec:daos_serv_start}
%TBD

\subsubsection{With the DAOS VOL connector as a dynamically-loaded plugin}

If the DAOS VOL connector is dynamically loaded by HDF5, The DAOS Pool UUID and DAOS Pool service replica rank list are passed via the two environment variables below. For more information on using the DAOS VOL connector as a dynamically-loaded plugin, refer to \hyperref[hdf5:dynamically_loaded_connectors]{HDF5 and dynamically-loaded VOL connectors}.

\begin{verbatim}
DAOS_POOL - The UUID of the DAOS pool to use

DAOS_SVCL - A comma-separated list of MPI ranks used for daos_pool_connect().
            Currently, for simple 1 MPI rank operations this should simply be
            specified as DAOS_SVCL=0
\end{verbatim}

\subsubsection{Without the DAOS VOL connector as a dynamically-loaded plugin}

If the DAOS VOL connector is not being dynamically loaded, the DAOS Pool UUID and DAOS Pool service replica rank list should be passed via the call to \hyperref[ref:h5daos_init]{H5daos\_init()}.

\subsubsection{Example Applications}

The file \texttt{test/daos\_vol/test\_daos\_vol.c} contains several test functions that are examples of applications in miniature, focused on a particular behavior. These mini-applications test a moderate amount of HDF5's public API functionality with the DAOS VOL connector and should be a good indicator of whether the DAOS VOL connector is working correctly in conjunction with a running HDF5 DAOS API-aware instance.

In addition to this file, some of the example C applications included with HDF5 distributions have been adapted to work with the DAOS VOL connector and are included under the top-level \texttt{examples} directory in the DAOS VOL connector source root directory.

\newpage

\section{HDF5 Feature support}

\subsection{HDF5 API support}

The following sections serve to illustrate the DAOS VOL connector's support for the HDF5 API, as well as to highlight any differences between the expected behavior of an HDF5 API call versus the actual behavior as implemented by the VOL connector. If a particular HDF5 API call does not appear among these tables, it is most likely a native HDF5-specific API call which cannot be implemented by non-native HDF5 VOL connectors. These types of API calls are listed among the tables in Appendix~\ref{apdx:native_calls}.

\newpage

\subsubsection{H5A interface}

\begin{center}

\textbf{Supported API calls}
\vspace{.2in} \\

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Acreate(1/2) & \\ \hline
H5Acreate\_by\_name & \\ \hline
H5Aopen(\_by\_name) & \\ \hline
H5Aopen\_name & \\ \hline
H5Awrite & \\ \hline
H5Aread & \\ \hline
H5Aclose & \\ \hline
H5Aiterate(2) & \begin{itemize}
                    \item Restarting iteration from an index value is currently unsupported
                    \item Only \texttt{H5\_ITER\_INC} and \texttt{H5\_ITER\_NATIVE} are supported for the iteration order
                \end{itemize}\\ \hline
H5Aiterate\_by\_name & \begin{itemize}
                           \item Restarting iteration from an index value is currently unsupported
                           \item Only \texttt{H5\_ITER\_INC} and \texttt{H5\_ITER\_NATIVE} are supported for the iteration order
                       \end{itemize}\\ \hline
H5Aexists(\_by\_name) & \\ \hline
H5Arename(\_by\_name) & \\ \hline
H5Adelete(\_by\_name) & \\ \hline
H5Aget\_name & \\ \hline
H5Aget\_space & \\ \hline
H5Aget\_type & \\ \hline
\end{tabularx}

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Aget\_info(\_by\_name/\_by\_idx) & Of the four fields in the \texttt{H5A\_info\_t} struct:
                                     \begin{itemize}
                                         \item \texttt{corder\_valid} is currently always set to \texttt{FALSE}
                                         \item \texttt{corder} is currently always set to 0 (no support for creation order yet)
                                         \item \texttt{cset} is currently always set to \texttt{H5T\_CSET\_ASCII}
                                         \item \texttt{data\_size} is set appropriately
                                     \end{itemize}\\ \hline
H5Aget\_create\_plist & \\ \hline

\end{tabularx}

\textbf{Currently unsupported API calls}
\vspace{.1in} \\

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Aopen\_by\_idx & Currently no support for attribute creation order \\ \hline
H5Aopen\_idx & Currently no support for attribute creation order \\ \hline
H5Adelete\_by\_idx & Currently no support for attribute creation order \\ \hline
H5Aget\_name\_by\_idx & Currently no support for attribute creation order \\ \hline
H5Aget\_storage\_size & \\ \hline

\end{tabularx}

\end{center}

\newpage

\subsubsection{H5D interface}

\begin{center}

\textbf{Supported API calls}
\vspace{.2in} \\

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Dcreate(1/2) & \\ \hline
H5Dcreate\_anon & \\ \hline
H5Dopen(1/2) & \\ \hline
H5Dwrite & \\ \hline
H5Dread & \\ \hline
H5Dclose & \\ \hline
H5Dextend & Upon dataset expansion or shrinking, data is currently left uninitialized instead of being initialized to 0\\ \hline
H5Dset\_extent & Upon dataset expansion or shrinking, data is currently left uninitialized instead of being initialized to 0\\ \hline
H5Dget\_space & \\ \hline
H5Dget\_type & \\ \hline
H5Dget\_create\_plist & \\ \hline
H5Dget\_access\_plist & \\ \hline

\end{tabularx}

\textbf{Currently unsupported API calls}
\vspace{.2in} \\

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Dflush & \\ \hline
H5Drefresh & \\ \hline
H5Dget\_storage\_size & \\ \hline
H5Dget\_space\_status & Space status is currently always set to \texttt{H5D\_SPACE\_STATUS\_NOT\_ALLOCATED}\\ \hline
H5Dget\_offset & \\ \hline

\end{tabularx}

\end{center}

\newpage

\subsubsection{H5F interface}

\begin{center}

\textbf{Supported API calls}
\vspace{.2in} \\

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Fcreate & \\ \hline
H5Fopen & \\ \hline
H5Freopen & \\ \hline
H5Fis\_accessible & \\ \hline
H5Fget\_create\_plist & \\ \hline
H5Fget\_access\_plist & \\ \hline
H5Fget\_intent & \\ \hline
H5Fget\_name & \\ \hline
H5Fget\_obj\_count & \\ \hline
H5Fget\_obj\_ids & \\ \hline
H5Fclose & \\ \hline

\end{tabularx}

\textbf{Currently unsupported API calls}
\vspace{.2in} \\

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Fflush & \\ \hline
H5Fmount & \\ \hline
H5Funmount & \\ \hline

\end{tabularx}

\end{center}

\newpage

\subsubsection{H5G interface}

\begin{center}

\textbf{Supported API calls}
\vspace{.2in} \\

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Gcreate(1/2) & \\ \hline
H5Gcreate\_anon & \\ \hline
H5Gopen(1/2) & \\ \hline
H5Gclose & \\ \hline
H5Gunlink & \\ \hline
H5Gget\_create\_plist & \\ \hline
H5Gget\_info(\_by\_name/\_by\_idx) & Of the four fields in the \texttt{H5G\_info\_t} struct:
                                     \begin{itemize}
                                         \item \texttt{storage\_type} is always set to \texttt{H5G\_STORAGE\_TYPE\_UNKNOWN}
                                         \item \texttt{nlinks} is set appropriately
                                         \item \texttt{max\_corder} is set appropriately if link creation order is tracked for the group
                                         \item \texttt{mounted} is currently always set to \texttt{FALSE}
                                     \end{itemize}
                                     For \texttt{H5Gget\_info\_by\_idx}, \texttt{H5\_ITER\_DEC} is currently unsupported for the index ordering when \texttt{H5\_INDEX\_NAME} is used for the index type\\ \hline
H5Gget\_linkval & \\ \hline
H5Gget\_num\_objs & \\ \hline
H5Gget\_objname\_by\_idx & \texttt{H5\_ITER\_DEC} is currently unsupported for the index ordering when \texttt{H5\_INDEX\_NAME} is used for the index type\\ \hline
H5Glink(2) & Currently only hard and soft link creation are supported\\ \hline

\end{tabularx}

\textbf{Currently unsupported API calls}
\vspace{.2in} \\

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Gflush & \\ \hline
H5Grefresh & \\ \hline
H5Gmove(2) & Will be supported once \texttt{H5Lmove} is supported\\ \hline

\end{tabularx}

\end{center}

\newpage

\subsubsection{H5L interface}

\begin{center}

\textbf{Supported API calls}
\vspace{.2in} \\

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Lcreate\_hard & Reference count tracking is not currently implemented, so objects will not be removed when the last hard link pointing to them is removed\\ \hline
H5Lcreate\_soft & \\ \hline
H5Lexists & \\ \hline
H5Literate(\_by\_name) & \begin{itemize}
                             \item Restarting iteration from an index value is currently unsupported
                             \item \texttt{H5\_ITER\_DEC} is currently unsupported for the iteration order when \texttt{H5\_INDEX\_NAME} is used for the index type
                         \end{itemize}\\ \hline
H5Lvisit(\_by\_name) & \begin{itemize}
                             \item Restarting iteration from an index value is currently unsupported
                             \item \texttt{H5\_ITER\_DEC} is currently unsupported for the iteration order when \texttt{H5\_INDEX\_NAME} is used for the index type
                         \end{itemize}\\ \hline
H5Ldelete & Reference count tracking is not currently implemented, so objects will not be removed when the last hard link pointing to them is removed\\ \hline
H5Ldelete\_by\_idx & \texttt{H5\_ITER\_DEC} is currently unsupported for the index ordering when \texttt{H5\_INDEX\_NAME} is used for the index type\\ \hline

\end{tabularx}

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Lget\_info & Of the five fields in the \texttt{H5L\_info\_t} struct:
                                     \begin{itemize}
                                         \item \texttt{type} is set appropriately
                                         \item \texttt{corder\_valid} is set to TRUE only if link creation order tracking is enabled for the group containing the link; it is set to FALSE otherwise
                                         \item \texttt{corder} is set appropriately if link creation order tracking is enabled for the group containing the link; it is set to 0 otherwise
                                         \item \texttt{cset} is currently always set to \texttt{H5T\_CSET\_ASCII}
                                         \item \texttt{u} has member \texttt{address} or \texttt{val\_size} set appropriately based on whether the link is a hard link or not
                                     \end{itemize}\\ \hline
H5Lget\_info\_by\_idx & \texttt{H5\_ITER\_DEC} is currently unsupported for the index ordering when \texttt{H5\_INDEX\_NAME} is used for the index type\\ \hline
H5Lget\_val & \\ \hline
H5Lget\_val\_by\_idx & \texttt{H5\_ITER\_DEC} is currently unsupported for the index ordering when \texttt{H5\_INDEX\_NAME} is used for the index type\\ \hline
H5Lget\_name\_by\_idx & \texttt{H5\_ITER\_DEC} is currently unsupported for the index ordering when \texttt{H5\_INDEX\_NAME} is used for the index type\\ \hline

\end{tabularx}

\textbf{Currently unsupported API calls}
\vspace{.2in} \\

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Lcopy & \\ \hline
H5Lmove & \\ \hline
H5Lcreate\_external & \\ \hline
H5Lcreate\_ud & \\ \hline


\end{tabularx}

\end{center}

\newpage

\subsubsection{H5O interface}

\begin{center}

\textbf{Supported API calls}
\vspace{.2in} \\

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Oopen & \\ \hline
H5Oopen\_by\_addr & \\ \hline
H5Oopen\_by\_idx & \texttt{H5\_ITER\_DEC} is currently unsupported for the index ordering when \texttt{H5\_INDEX\_NAME} is used for the index type\\ \hline
H5Oclose & \\ \hline
H5Olink & \\ \hline
H5Oexists\_by\_name & \\ \hline
H5Ovisit(1/2) & \texttt{H5\_ITER\_DEC} is currently unsupported for the index ordering when \texttt{H5\_INDEX\_NAME} is used for the index type\\ \hline
H5Ovisit\_by\_name(1/2) & \texttt{H5\_ITER\_DEC} is currently unsupported for the index ordering when \texttt{H5\_INDEX\_NAME} is used for the index type\\ \hline

\end{tabularx}

\textbf{Currently unsupported API calls}
\vspace{.2in} \\

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Ocopy & \\ \hline
H5Oflush & \\ \hline
H5Orefresh & \\ \hline
H5Oincr\_refcount & \\ \hline
H5Odecr\_refcount & \\ \hline

\end{tabularx}

\end{center}

\newpage

\subsubsection{H5R interface}

\begin{center}

\textbf{Supported API calls}
\vspace{.2in} \\

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

 & \\ \hline

\end{tabularx}

\textbf{Currently unsupported API calls}
\vspace{.2in} \\

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Rcreate & \\ \hline
H5Rdereference(1/2) & Causes an assertion failure\\ \hline
H5Rget\_name & \\ \hline
H5Rget\_obj\_type(1/2) & \\ \hline
H5Rget\_region & \\ \hline

\end{tabularx}

\end{center}

\newpage

\subsubsection{H5T interface}

\begin{center}

\textbf{Supported API calls}
\vspace{.2in} \\

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Tcommit(1/2) & \\ \hline
H5Tcommit\_anon & \\ \hline
H5Topen(1/2) & \\ \hline
H5Tclose & \\ \hline
H5Tget\_create\_plist & \\ \hline

\end{tabularx}

\textbf{Currently unsupported API calls}
\vspace{.2in} \\

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Tflush & \\ \hline
H5Trefresh & \\ \hline

\end{tabularx}

\end{center}

\newpage

\subsection{Feature support}

The following sections serve to illustrate the DAOS VOL connector's support for features in HDF5, as well as to highlight any differences between the expected behavior of an HDF5 feature versus the actual behavior as implemented by the VOL connector.

\newpage

\subsubsection{Attribute Features}

\begin{tabularx}{\linewidth}{| X | X | X | X | X |}
\hline
% Center just the header row
\multicolumn{3}{| c |}{\textbf{Feature}} & \multicolumn{1}{c |}{\textbf{DAOS VOL connector support?}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

\multirow[c]{3}{\linewidth}{Dataspace} & \multirow[c]{3}{\linewidth}{Dimensionality} & H5S\_NULL & Yes & \\ \cline{3-4}
& & H5S\_SCALAR & Yes & \\ \cline{3-4}
& & SIMPLE & Yes & \\ \cline{3-4} \hline

\multicolumn{2}{| l |}{\multirow[c]{6}{*}[-90pt]{Datatype}} & Atomic & Yes & \multirow[c]{5}{\linewidth}{Variable-length datatypes inside Compound, Variable-length or Array datatypes will be supported in MS3. Datatype conversion for the parent datatype will be supported in MS3. Reference types will be supported in MS3.} \\ [30pt] \cline{3-4}
\multicolumn{2}{| l |}{} & Compound & Yes & \\ [30pt] \cline{3-4}
\multicolumn{2}{| l |}{} & Variable-length & Yes & \\ [30pt] \cline{3-4}
\multicolumn{2}{| l |}{} & Array & Yes & \\ [30pt] \cline{3-4}
\multicolumn{2}{| l |}{} & Opaque & Yes & \\ [30pt] \cline{3-4}
\multicolumn{2}{| l |}{} & Reference & No & \\ [30pt] \cline{3-4}
\hline

\multirow[c]{2}{\linewidth}[-10pt]{Properties} & \multirow[c]{2}{\linewidth}[-10pt]{Name Encoding} & ASCII & Yes & \\ \cline{3-5}
& & UTF-8 & No & Will be supported in MS3 \\ \cline{3-4} \hline

\end{tabularx}

\newpage

\subsubsection{Dataset Features}

\begin{tabularx}{\linewidth}{| X | X | X | X | X |}
\hline
% Center just the header row
\multicolumn{3}{| c |}{\textbf{Feature}} & \multicolumn{1}{c |}{\textbf{DAOS VOL connector support?}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

\multirow[c]{7}{\linewidth}[-45pt]{Dataspace} & \multirow[c]{3}{\linewidth}{Dimensionality} & H5S\_NULL & Yes & \multirow[c]{3}{\linewidth}{Supported in MS2} \\ \cline{3-4}
& & H5S\_SCALAR & Yes & \\ \cline{3-4}
& & SIMPLE & Yes & \\ \cline{3-4} \cline{2-5}
& \multirow[c]{4}{\linewidth}[-55pt]{Selection Type} & NONE & Yes & \multirow[c]{4}{\linewidth}{For chunked datasets, the selection should be the same shape in the memory and file dataspaces; different shapes will be supported in MS3} \\ [28pt] \cline{3-4}
& & H5S\_ALL & Yes & \\ [28pt] \cline{3-4}
& & Hyperslab Selection & Yes & \\ [28pt] \cline{3-4}
& & Point Selection & Yes & \\ [28pt] \cline{3-4} \hline

\multicolumn{2}{| l |}{\multirow[c]{6}{*}[-90pt]{Datatype}} & Atomic & Yes & \multirow[c]{5}{\linewidth}{Variable-length datatypes inside Compound, Variable-length or Array datatypes will be supported in MS3. Datatype conversion for the parent datatype will be supported in MS3. Reference types will be supported in MS3.} \\ [30pt] \cline{3-4}
\multicolumn{2}{| l |}{} & Compound & Yes & \\ [30pt] \cline{3-4}
\multicolumn{2}{| l |}{} & Variable-length & Yes & \\ [30pt] \cline{3-4}
\multicolumn{2}{| l |}{} & Array & Yes & \\ [30pt] \cline{3-4}
\multicolumn{2}{| l |}{} & Opaque & Yes & \\ [30pt] \cline{3-4}
\multicolumn{2}{| l |}{} & Reference & No & \\ [30pt] \cline{3-4}
\hline

\end{tabularx}

\newpage

\begin{tabularx}{\linewidth}{| X | X | X | X | X |}
\hline
% Center just the header row
\multicolumn{3}{| c |}{\textbf{Feature}} & \multicolumn{1}{c |}{\textbf{DAOS VOL connector support?}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

\multirow[c]{9}{\linewidth}[-130pt]{Properties} & \multirow[c]{5}{\linewidth}[-50pt]{Storage Properties (creation)} & Compact & No & Setting is ignored; stored as contiguous \\ \cline{3-5}
& & External & No & Setting is ignored; stored as contigous \\ \cline{3-5}
& & Contiguous & Yes & Default storage type \\ \cline{3-5}
& & Chunked & Yes & \\ \cline{3-5}
& & VDS & No & Will be supported in MS3 \\ \cline{2-5}
& \multirow[c]{4}{\linewidth}[-80pt]{Other Properties (creation)} & Attribute Creation Order & No & Will be supported in MS3. The feature will only work when a file is touched in collective mode. \\ \cline{3-5}
& & Fill Value & No & Will be supported in MS3 \\ \cline{3-5}
& & Filters & No & May be supported in the future. \\ \cline{3-5}
& & Storage Allocation Time & N/A & \\ \hline

\end{tabularx}

\newpage

\begin{tabularx}{\linewidth}{| X | X | X | X | X |}
\hline
% Center just the header row
\multicolumn{3}{| c |}{\textbf{Feature}} & \multicolumn{1}{c |}{\textbf{DAOS VOL connector support?}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

\multirow[c]{4}{\linewidth}[-90pt]{Properties (cont.)} & \multirow[c]{3}{\linewidth}[-60pt]{Access Properties} & Chunk cache & No & May be supported in the future. \\ \cline{3-5}
& & VDS views and printf & No & Will be supported in MS3 \\ \cline{3-5}
& & MPI-I/O Collective Metadata Ops & Yes & By default, all metadata operations are collective for writes and independent for reads. \\ \cline{2-5}
& \multirow[c]{1}{\linewidth}[-15pt]{Transfer Properties} & MPI-I/O Independent or Collective I/O mode & N/A & \\ \hline

\end{tabularx}

\subsubsection{File Features}

\begin{tabularx}{\linewidth}{| X | X | X | X | X |}
\hline
% Center just the header row
\multicolumn{3}{| c |}{\textbf{Feature}} & \multicolumn{1}{c |}{\textbf{DAOS VOL connector support?}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

\multicolumn{2}{| l |}{\multirow[c]{2}{*}{File creation flags}} & \multicolumn{1}{l |}{H5F\_ACC\_TRUNC} & Yes & \multirow[c]{4}{\linewidth}{The file creation flags behave as for native HDF5.} \\ \cline{3-4}
\multicolumn{2}{| l |}{} & \multicolumn{1}{l |}{H5F\_ACC\_EXCL} & Yes & \\ \cline{1-4}
\multicolumn{2}{| l |}{\multirow[c]{2}{*}{File opening flags}} & \multicolumn{1}{l |}{H5F\_ACC\_RDWR} & Yes & \\ \cline{3-4}
\multicolumn{2}{| l |}{} & \multicolumn{1}{l |}{H5F\_ACC\_RDONLY} & Yes & \\ \hline

\multirow[c]{8}{\linewidth}[-100pt]{Properties} & \multirow[c]{1}{\linewidth}[-70pt]{Creation Properties} & Attribute Creation Order & No & Attribute creation order property will be supported in MS3. The rest of the file creation properties are related to the native HDF5-specific file format. \\ \cline{2-5}

& \multirow[c]{7}{\linewidth}{Access Properties (Drivers)} & SEC2 Driver & N/A & \multirow[c]{4}{\linewidth}{These drivers are applicable to native HDF5 only.} \\ \cline{3-4}
& & Family Driver & N/A & \\ \cline{3-4}
& & Split Driver & N/A & \\ \cline{3-4}
& & Multi Driver & N/A & \\ \cline{3-5}
& & Core Driver & N/A & It is reasonable to implement this driver in the future with a backing store in DAOS. \\ \hline

\end{tabularx}

\newpage

\begin{tabularx}{\linewidth}{| X | X | X | X | X |}
\hline
% Center just the header row
\multicolumn{3}{| c |}{\textbf{Feature}} & \multicolumn{1}{c |}{\textbf{DAOS VOL connector support?}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

\multirow[c]{10}{\linewidth}[-150pt]{Properties (cont.)} & \multirow[c]{2}{\linewidth}[-45pt]{Access Properties (Drivers, cont.)} & Log Driver & N/A & \\ \cline{3-5}
& & MPI-I/O & Yes & This property just indicates parallel access to the file; it doesn't use HDF5 MPI I/O driver underneath. \\ \cline{2-5}

& \multirow[c]{8}{\linewidth}[-80pt]{Access Properties (Other)} & MPI-I/O Collective Metadata Ops & Yes & By default, all metadata operations are collective for writes and independent for reads. \\ \cline{3-5}
& & User block & N/A & \\ \cline{3-5}
& & Chunk Cache & No & May be supported in the future. \\ \cline{3-5}
& & Object flushing callbacks & N/A & \\ \cline{3-5}
& & File closing degree & N/A & \\ \cline{3-5}
& & Evict on close & N/A & \\ \cline{3-5}
& & Sieve buffer size for partial I/O & No & May be supported in the future. \\ \cline{3-5}
& & File Image & N/A & \\ \hline

\end{tabularx}

\subsubsection{Group Features}

\begin{tabularx}{\linewidth}{| X | X | X | X | X |}
\hline
% Center just the header row
\multicolumn{3}{| c |}{\textbf{Feature}} & \multicolumn{1}{c |}{\textbf{DAOS VOL connector support?}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

\multirow[c]{4}{\linewidth}[-150pt]{Properties} & \multirow[c]{3}{\linewidth}[-130pt]{Creation Properties} & Link Creation Order & No & Will be supported in MS3. The feature will only work when a file is touched in collective mode. \\ \cline{3-5}
& & Attribute Creation Order & No & Will be supported in MS3. The feature will only work when a file is touched in collective mode. \\ \cline{3-5}
& & Other Properties & N/A & These properties are related to the native HDF5-specific file format. \\ \cline{2-5}
& \multirow[c]{1}{\linewidth}[-35pt]{Access Properties} & MPI-I/O Collective Metadata Ops & Yes & By default, all metadata operations are collective for writes and independent for reads. \\ \hline

\end{tabularx}

\newpage

\section{Testing}

\subsection{HDF5 and dynamically-loaded VOL connectors}
\label{hdf5:dynamically_loaded_connectors}

HDF5 has the capability to dynamically load and use a VOL connector for running applications with.

In order to choose a particular VOL connector to use, two initial steps must be taken. First, one must help HDF5 locate the VOL connector by pointing to the directory which contains the built library. This can be accomplished by setting the environment variable \texttt{HDF5\_PLUGIN\_PATH} to this directory. Next, HDF5 needs to know the name of which library to use, which is configured by setting the environment variable \texttt{HDF5\_VOL\_CONNECTOR} to the name of the connector.

In order to use the DAOS VOL connector, the aforementioned environment variables should be set as:

\begin{verbatim}
HDF5_PLUGIN_PATH=/daos/vol/installation/directory/lib
HDF5_VOL_CONNECTOR=daos
\end{verbatim}

Having completed this step, HDF5 will be setup to load the DAOS VOL connector and use it for running applications, including the HDF5 tests. While several HDF5 tests have been updated to take advantage of this capability, please be aware that many of these tests are likely to fail or crash due to their native HDF5-specific nature.

\newpage

\subsection{Testing the DAOS VOL connector}

\subsubsection{Generic VOL connector test suite}

In order to test VOL connectors to make sure that they are functioning as expected, a suite of tests which only use the public HDF5 API has been written. This suite of tests is available under the path:

\begin{verbatim}
test/vol/vol_test.c
\end{verbatim}

Currently, this test suite does not have the capability to query what kind of functionality a VOL connector supports and therefore a test will fail if it uses an HDF5 API call which is not implemented, or which is specifically unsupported, in a given VOL connector.

To test the DAOS VOL connector with this test suite, first refer to \hyperref[hdf5:dynamically_loaded_connectors]{HDF5 and dynamically-loaded VOL connectors} to ensure that HDF5 is setup to dynamically load the DAOS VOL connector and then refer to \hyperref[sec:daos_serv_start]{Starting the DAOS Server} and \hyperref[running_daos_vol_apps]{Running HDF5 DAOS VOL connector applications} to make sure that the DAOS Server is up and running and your environment is setup correctly. Once that is done, tests can be run against the DAOS VOL connector and it should be as simple as running:

\begin{verbatim}
make check
\end{verbatim}

for Autotools builds, or:

\begin{verbatim}
cd builddir
ctest .
\end{verbatim}

for CMake builds\footnote{Automated testing is still under development for CMake builds.}.

\subsubsection{DAOS VOL connector-specific test suite}

There is no DAOS specific test as of this writing.

\newpage
\appendix

\section{Reference Manual}
\label{apdx:ref_manual}
\input{ref_manual}

\newpage
\section{Native VOL connector API calls}
\label{apdx:native_calls}

The following HDF5 API calls are either specific to the native HDF5 VOL connector or are not routed through the VOL and thus are not able to be implemented by the DAOS VOL connector (or other VOL connectors):

\subsection{H5A interface}

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Aiterate1 & Deprecated in favor of H5Aiterate2 \\ \hline
H5Aget\_num\_attrs & Deprecated in favor of H5Oget\_info \\ \hline

\end{tabularx}

\subsection{H5D interface}

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Dformat\_convert & \\ \hline
H5Dget\_chunk\_index\_type & \\ \hline
H5Dget\_chunk\_storage\_size & \\ \hline
H5Dvlen\_reclaim & \\ \hline
H5Dvlen\_get\_buf\_size & \\ \hline
H5Diterate & \\ \hline
H5Dscatter & \\ \hline
H5Dgather & \\ \hline
H5Dfill & \\ \hline
H5Dread\_chunk & \\ \hline
H5Dwrite\_chunk & \\ \hline

\end{tabularx}

\subsection{H5F interface}

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Fis\_hdf5 & Uses a default FAPL so can only ever be routed through the native HDF5 VOL connector\\ \hline
H5Fget\_vfd\_handle & \\ \hline
H5Fget\_freespace & \\ \hline
H5Fget\_filesize & \\ \hline
H5Fget\_file\_image & \\ \hline
H5Fget\_mdc\_config & \\ \hline
H5Fset\_mdc\_config & \\ \hline
H5Fget\_mdc\_hit\_rate & \\ \hline
H5Fget\_mdc\_size & \\ \hline
H5Freset\_mdc\_hit\_rate\_stats & \\ \hline
H5Fget\_info(1/2) & \\ \hline
H5Fget\_metadata\_read\_retry\_info & \\ \hline
H5Fget\_free\_sections & \\ \hline
H5Fclear\_elink\_file\_cache & \\ \hline
H5Fstart\_swmr\_write & \\ \hline
H5Fstart\_mdc\_logging & \\ \hline
H5Fstop\_mdc\_logging & \\ \hline
H5Fget\_mdc\_logging\_status & \\ \hline
H5Fset\_libver\_bounds & \\ \hline
H5Fformat\_convert & \\ \hline
H5Freset\_page\_buffering\_stats & \\ \hline
H5Fget\_page\_buffering\_stats & \\ \hline
H5Fget\_mdc\_image\_info & \\ \hline
H5Fget\_eoa & \\ \hline
H5Fincrement\_filesize & \\ \hline
H5Fget\_dset\_no\_attrs\_hint & \\ \hline
H5Fset\_dset\_no\_attrs\_hint & \\ \hline
H5Fset\_latest\_format & \\ \hline
H5Fset\_mpi\_atomicity & \\ \hline
H5Fget\_mpi\_atomicity & \\ \hline

\end{tabularx}

\subsection{H5G interface}

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Gset\_comment & Deprecated in favor of H5Oset\_comment/H5Oset\_comment\_by\_name \\ \hline
H5Gget\_comment & Deprecated in favor of H5Oget\_comment/H5Oget\_comment\_by\_name \\ \hline
H5Giterate & Deprecated in favor of H5Literate \\ \hline
H5Gget\_objinfo & Deprecated in favor of H5Lget\_info/H5Oget\_info \\ \hline
H5Gget\_objtype\_by\_idx & Deprecated in favor of H5Lget\_info/H5Oget\_info \\ \hline

\end{tabularx}

\subsection{H5L interface}

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Lregister & \\ \hline
H5Lunregister & \\ \hline
H5Lis\_registered & \\ \hline
H5Lunpack\_elink\_val & \\ \hline

\end{tabularx}

\subsection{H5O interface}

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

H5Oget\_info(1/2) & \\ \hline
H5Oget\_info\_by\_name(1/2) & \\ \hline
H5Oget\_info\_by\_idx(1/2) & \\ \hline
H5Oset\_comment(\_by\_name) & Deprecated in favor of using attributes on objects \\ \hline
H5Oget\_comment(\_by\_name) & Deprecated in favor of using attributes on objects \\ \hline
H5Oare\_mdc\_flushes\_disabled & \\ \hline
H5Oenable\_mdc\_flushes & \\ \hline
H5Odisable\_mdc\_flushes & \\ \hline

\end{tabularx}

\subsection{H5R interface}

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

& \\ \hline

\end{tabularx}

\subsection{H5T interface}

\begin{tabularx}{\linewidth}{| X | X |}
\hline
% Center just the header row
\multicolumn{1}{| c |}{\textbf{API call}} & \multicolumn{1}{c |}{\textbf{Notes}} \\ \hline

& \\ \hline

\end{tabularx}

